Here is a comprehensive developer documentation for the current state of your app, focusing on the file structure, key files, and how to add new functionality.

---

# Developer Documentation

## Table of Contents

- Overview
- Project Structure
- Backend Architecture
  - Key Backend Files
  - Adding Backend Functionality
- Frontend Architecture
  - Key Frontend Files
  - Adding Frontend Functionality
- API Endpoints
- Database Structure
- Development Workflow
- Best Practices

---

## Overview

This application is a modular file manager and prompt system, with a Node.js/Express backend and a vanilla JavaScript frontend. MongoDB is used for persistent storage. The codebase is organized for clarity and extensibility, following MVC and component-based patterns.

---

## Project Structure

```
apps/
  brain-dev/
    backend/
      config/
      controllers/
      middleware/
      models/
      public/
      routes/
      util/
      server.js
    documentation/
    frontend/
      css/
      js/
        components/
        services/
        utils/
      index.html
      styles.css
    testdata/
    README.md
    package.json
    start.sh
```

---

## Backend Architecture

The backend is a Node.js/Express app using MongoDB for storage. It follows an MVC (Model-View-Controller) pattern.

### Key Backend Files

- **server.js**: Main entry point. Sets up Express, connects to MongoDB, configures middleware, and registers API routes.
- **db.js**: Handles MongoDB connection logic.
- **server.js**: Server and port configuration, MIME types.
- **controllers/**: Business logic for each resource.
  - fileController.js
  - promptController.js
  - substituteController.js
- **models/**: MongoDB data access for each resource.
  - file.js
  - prompt.js
  - substitute.js
- **routes/**: Express routers for each resource.
  - fileRoutes.js
  - promptRoutes.js
  - substituteRoutes.js
  - index.js: Combines all routes.
- **middleware/**: (e.g., error handling, CORS, body parsing)
- **public/**: Static files for the backend (e.g., env-config.js).

### Adding Backend Functionality

1. **Add a New Resource (e.g., "notes"):**
   - Create a model in `backend/models/notes.js`.
   - Create a controller in `backend/controllers/notesController.js`.
   - Add a router in `backend/routes/notesRoutes.js`.
   - Register the new router in index.js and in server.js if needed.
   - Update the database schema documentation in architecture.md.

2. **Add a New API Endpoint:**
   - Add a method to the relevant controller.
   - Add a route in the corresponding router file.
   - Document the endpoint in architecture.md.

3. **Modify Data Structure:**
   - Update the model and controller logic.
   - Update the database structure documentation.

---

## Frontend Architecture

The frontend is a vanilla JavaScript SPA using ES6 modules and a component-based structure.

### Key Frontend Files

- **index.html**: Main HTML entry point.
- **app.js**: Main application logic, initializes components and handles view switching.
- **api.js**: Handles all API requests to the backend.
- **js/components/**: UI modules for each feature.
  - fileTree.js: File/folder navigation and drag-and-drop.
  - fileContent.js: File/folder content display and editing.
  - fileCreation.js: UI for creating files/folders.
  - prompts.js: Prompt management UI.
  - substitutes.js: Substitute management UI.
  - `markdownLineEditor.js`: (if present) Markdown editing.
- **js/utils/**: Helper functions.
  - `uiUtils.js`: UI helpers (e.g., showError, toggleView).
  - `error.js`: Error handling.

### Adding Frontend Functionality

1. **Add a New UI Feature:**
   - Create a new component in `js/components/`.
   - Register and initialize it in app.js.
   - Add any new API calls to api.js.

2. **Add a New API Call:**
   - Add a method to api.js that matches the backend endpoint.

3. **Add a New View or Tab:**
   - Add a button and view section in `index.html`.
   - Add logic in app.js to handle view switching and initialization.

4. **Modify File/Prompt/Substitute UI:**
   - Update the relevant component in `js/components/`.
   - Update the API service if new endpoints are needed.

---

## API Endpoints

### Files

- `GET /api/files`: Get file tree
- `GET /api/files/file?path={path}`: Get file by path
- `POST /api/files`: Create new file or folder
- `PUT /api/files/file?path={path}`: Update file content/metadata
- `DELETE /api/files/file?path={path}`: Delete file or folder

### Prompts

- `GET /api/prompts`: Get all prompts
- `GET /api/prompts/prompt?id={id}`: Get prompt by ID
- `POST /api/prompts`: Create new prompt
- `PUT /api/prompts/prompt?id={id}`: Update prompt
- `DELETE /api/prompts/prompt?id={id}`: Delete prompt

### Substitutes

- `GET /api/substitutes`: Get all substitutes
- `GET /api/substitutes/substitute?id={id}`: Get substitute by ID
- `POST /api/substitutes`: Create new substitute
- `PUT /api/substitutes/substitute?id={id}`: Update substitute
- `DELETE /api/substitutes/substitute?id={id}`: Delete substitute

---

## Database Structure

### Files Collection

```js
{
  _id: ObjectId,
  name: String,
  type: String, // 'folder', 'txt', 'md', 'pdf', 'epub'
  path: String, // unique
  parentPath: String,
  content: String,
  createdAt: Date,
  updatedAt: Date
}
```

### Prompts Collection

```js
{
  _id: ObjectId,
  title: String,
  text: String,
  createdAt: Date,
  updatedAt: Date
}
```

### Substitutes Collection

```js
{
  _id: ObjectId,
  name: String,
  filePath: String,
  createdAt: Date,
  updatedAt: Date
}
```

---

## Development Workflow

1. **Start MongoDB** (if not running as a service):
   ```bash
   mongod --dbpath /path/to/data/directory
   ```

2. **Start the backend server:**
   ```bash
   cd apps/brain-dev/backend
   node server.js
   ```

3. **Serve the frontend:**
   - Open `frontend/index.html` directly in a browser, or
   - Serve with a static server:
     ```bash
     cd apps/brain-dev/frontend
     npx serve
     ```

4. **Edit code in the appropriate component, model, controller, or service.**

---

## Best Practices

- **Keep models, controllers, and routes modular.**
- **Document new endpoints and data structures in architecture.md.**
- **Use consistent error handling (see controller patterns).**
- **Frontend API calls should always go through api.js.**
- **UI logic should be encapsulated in components.**
- **Test new features with both backend and frontend running.**

---

## Where to Add Functionality

- **Backend logic:** `backend/controllers/`, `backend/models/`, `backend/routes/`
- **Frontend UI:** `frontend/js/components/`
- **API calls:** api.js
- **Shared helpers:** `frontend/js/utils/`
- **Documentation:** architecture.md

---

This documentation should provide a future developer with a clear roadmap for extending the application, understanding the file structure, and following best practices for maintainability and scalability.